% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bootstrap_clusters.R
\name{bootstrap_clusters}
\alias{bootstrap_clusters}
\title{Bootstrap Cluster Stability Analysis}
\usage{
bootstrap_clusters(
  seurat_obj,
  clusters = NULL,
  reduction = "pca",
  dims = 1:30,
  resolution = 0.3,
  algorithm = 1,
  n.cells = NULL,
  iterations = 50,
  verbose = TRUE
)
}
\arguments{
\item{seurat_obj}{A processed Seurat object with dimensionality reduction
already computed (e.g., PCA, NMF).}

\item{clusters}{A character or factor vector of cluster labels for each cell.
Defaults to \code{Idents(seurat_obj)} if not provided.}

\item{reduction}{Character string specifying the dimensionality reduction to
use for neighbor finding (e.g., \code{"pca"}, \code{"nmf"}, \code{"mnn"}).
Default is \code{"pca"}.}

\item{dims}{Integer vector of dimensions to use from the reduction. Default
is \code{1:30}.}

\item{resolution}{Numeric value for the clustering resolution parameter
passed to \code{Seurat::FindClusters}. Default is \code{0.3}.}

\item{algorithm}{Integer specifying the clustering algorithm.
1 = Louvain (default), 2 = Louvain with multilevel refinement,
3 = SLM, 4 = Leiden (requires leidenalg Python module).}

\item{n.cells}{Integer specifying the number of cells to sample per
iteration. Default is the total number of cells in the object.}

\item{iterations}{Integer specifying the number of bootstrap iterations.
Default is \code{50}.}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages.
Default is \code{TRUE}.}
}
\value{
A numeric matrix of co-assignment probabilities. Rows and columns
correspond to original cluster identities. Values range from 0 to 1.
The lower triangle is set to \code{NA} (matrix is symmetric).
}
\description{
Evaluates cluster stability in a Seurat object by bootstrap resampling
and computing co-assignment probabilities. In each iteration, cells are
resampled with replacement and reclustered independently. The co-assignment
probability between two clusters is the dot product of their normalized
spread vectors across bootstrap reclusters, averaged over all iterations.
}
\details{
\strong{Bootstrap resampling:} Each iteration samples \code{n.cells} cells with
replacement from the Seurat object. With full-size resampling
(\code{n.cells = ncol(seurat_obj)}), approximately 63.2\\% of unique cells
appear per resample.

\strong{Handling Seurat duplicates:} Since Seurat objects cannot hold cells with
identical barcodes, only unique cells are subset for reclustering. Results
are mapped back to the full bootstrap sample via index matching, preserving
correct co-assignment frequencies.

\strong{Missing clusters:} Small clusters may be absent from some bootstrap
samples. The function tracks valid iterations per cluster pair and averages
only over iterations where both clusters were represented.

\strong{Probability bounds:} Co-assignment scores are dot products of vectors
that each sum to 1, guaranteeing values in [0, 1] by the Cauchy-Schwarz
inequality.
}
\examples{
\dontrun{
# Basic usage with PCA
coassign <- bootstrap_clusters(seurat_obj, reduction = "pca",
                               dims = 1:20, resolution = 0.3)

# Using NMF reduction with custom clusters
coassign <- bootstrap_clusters(seurat_obj,
                               clusters = seurat_obj$cell_type,
                               reduction = "nmf", dims = 1:15,
                               resolution = 0.5, iterations = 100)

# Quick test with fewer iterations
coassign <- bootstrap_clusters(seurat_obj, iterations = 10)
}

}
